<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>donut-chart-legend</title>
    <style>
        svg{
            border: 1px solid red;
        }
        table{
            border: 1px solid #000;
        }
        td{
            border: 1px solid #000;
            text-align: center;
        }
        .text-reg {
            fill: none;
            stroke: #fff;
        }

        .text-positive {
            fill: none;
            stroke: #0054a6;
        }

        .text-negative {
            fill: none;
            stroke: #9e0b0f;
        }
    </style>
</head>
<body>
    <table>
    <tr>
        <td>Group Performance</td>
        <td>Group Total</td>
        <td>Line Discounts</td>
        <td>Group Sales</td>
    </tr>
    <tr>
        <td>Group Name</td>
        <td>$10,000.00</td>
        <td>
    <div id="container"></div></td>
        <td>
    <div id="container2"></div></td>
    </tr>
    </table>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript">
   
        var max_value = 300;
        var value = -2;
        var text = "$80.000.00";
       
        var _width = 300,
            _height = 30;

        var bar_align = "right";

        var bar_color = "#9e0b0f";
        // if(color && color !=null  && color.length>0){
        //     bar_color = color;
        // }else{
        //     if(bar_align == "left"){
        //         bar_color = "#0054a6";
        //     }else{
        //         bar_color = "#9e0b0f";
        //     }
        // }

        var svg = d3.select("#container")
            .append("svg")
            .attr("width", _width)
            .attr("height", _height);
        
        var bar_width = (Math.abs(value)/ Math.abs(max_value)) * _width;
      
        // add bar
        svg.append("rect")
            .style("fill", bar_color)
            .attr("x", function(){
                if(bar_align == "left"){
                    return 0;
                }else{
                    return (_width - bar_width);
                }
            })
            .attr("y", 0)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("width", bar_width)
            .attr("height", _height);
        
        // add text
        var bar_text = svg.append("text")
            .text(text);
            //.style("font-size", 10)
            bar_text.attr("fill", function(){
                var text_width = this.getComputedTextLength();
                if(bar_align =="left"){
                    if((text_width + 5) > bar_width){
                        return bar_color;
                    }else{
                        return "#fff";
                    }
                }else{
                    if((text_width + 5) > bar_width){
                        return bar_color;
                    }else{
                        return "#fff";
                    }
                }
            })
            .attr("x", function(){
                var text_width = this.getComputedTextLength();
                console.log("id: container, text_width: " + text_width);
                if(bar_align =="left"){
                    if((text_width + 5) > bar_width){
                        console.log("x_left_1");
                        return (bar_width + 5);
                    }else{
                        console.log("x_left_0");
                        return (bar_width - text_width + 5);
                    }
                }else{
                    if((text_width + 5) > bar_width){
                        console.log("x_rignt_1");
                        return _width - (bar_width + text_width + 5);
                    }else{
                        console.log("x_right_0");
                        return _width - (bar_width - 5);
                    }
                }
            })
            .attr("y", function(){
                return 14;
            })
            .attr("dy",".35em")
            //.attr("text-anchor", "left");
            .attr("text-anchor", function(){
                var text_width = this.getComputedTextLength();
                if( bar_align == "left"){
                    if(text_width == 0){
                        return "start";
                    }else{
                        return "end";
                    }
                }else{
                    if(text_width == 0){
                        return "end";
                    }else{
                        return "start";
                    }
                }
            });
       
    </script>
    <script type="text/javascript">
   
       var max_value = 300;
        var value = 200;
        var text = "$99,000.00";

        var _width = 300,
            _height = 30;

        var bar_align ="left";

        var bar_color = "#0054a6";
        // if(color && color !=null  && color.length>0){
        //     bar_color = color;
        // }else{
        //     if(bar_align == "left"){
        //         bar_color = "#0054a6";
        //     }else{
        //         bar_color = "#9e0b0f";
        //     }
        // }

        var svg = d3.select("#container2")
            .append("svg")
            .attr("width", _width)
            .attr("height", _height);
        
        var bar_width = (Math.abs(value)/ Math.abs(max_value)) * _width;
      
        // add bar
        svg.append("rect")
            .style("fill", bar_color)
            .attr("x", function(){
                if(bar_align == "left"){
                    return 0;
                }else{
                    return (_width - bar_width);
                }
            })
            .attr("y", 0)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("width", bar_width)
            .attr("height", _height);
        
        // add text
        var bar_text = svg.append("text")
            .text(text);
            //.style("font-size", 10)
            bar_text.attr("fill", function(){
                var text_width = this.getComputedTextLength();
                if(bar_align =="left"){
                    if((text_width + 5) > bar_width){
                        return bar_color;
                    }else{
                        return "#fff";
                    }
                }else{
                    if((text_width + 5) > bar_width){
                        return bar_color;
                    }else{
                        return "#fff";
                    }
                }
            })
            .attr("x", function(){
                var text_width = this.getComputedTextLength();
                console.log("id: container2, text_width: " + text_width);
                if(bar_align =="left"){
                    if((text_width + 5) > bar_width){
                        console.log("x_left_1");
                        return (bar_width + 5);
                    }else{
                        return (bar_width - text_width - 5);
                        console.log("x_left_0");
                    }
                }else{
                    if((text_width + 5) > bar_width){
                        console.log("x_rignt_1");
                        return _width - (bar_width + text_width + 5);
                    }else{
                        console.log("x_right_0");
                        return _width - (bar_width - 5);
                    }
                }
            })
            .attr("y", function(){
                return 14;
            })
            .attr("dy",".35em")
            .attr("text-anchor", "start");
            // .attr("text-anchor", function(){
            //     if( bar_align == "left"){
            //         return "start";
            //     }else{
            //         return "end";
            //     }
            // });
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>donut-chart-legend</title>
    <style>
        svg{
            border: 1px solid red;
        }
        table{
            border: 1px solid #000;
        }
        td{
            border: 1px solid #000;
            text-align: center;
        }
        .text-reg {
            fill: none;
            stroke: #fff;
        }

        .text-positive {
            fill: none;
            stroke: #0054a6;
        }

        .text-negative {
            fill: none;
            stroke: #9e0b0f;
        }
    </style>
</head>
<body>
    <table>
    <tr>
        <td>Group Performance</td>
        <td>Group Total</td>
        <td>Line Discounts</td>
        <td>Group Sales</td>
    </tr>
    <tr>
        <td>Group Name</td>
        <td>$10,000.00</td>
        <td>
    <div id="container"></div></td>
        <td>
    <div id="container2"></div></td>
    </tr>
    </table>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript">

   
        var max_value = 300;
        var value = -160;
        var text = "";
       
        var width = 300,
            height = 30;

        var positive_color = "#0054a6";
        var negative_color = "#9e0b0f";

        var svg = d3.select("#container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
        var barWidth = (Math.abs(value)/ Math.abs(max_value)) * width;

        var text = svg.append("text")
            .text("$80,000.00")
            .style("font-size", 10)
            .attr("fill", function(){
                var text_width = this.getComputedTextLength();
                if(value >=0 ){
                    if((text_width + 5) > barWidth){
                        console.log("text-1-1");
                        return "#fff";
                    }else{
                        console.log("text-1-2");
                        return positive_color;
                    }
                }else{
                    if((text_width + 5) > barWidth){
                        console.log("text-2-1");
                        return negative_color;
                    }else{
                        console.log("text-2-2");
                        return "#fff";
                    }
                }
            })
            .attr("x", function(){
                var text_width = this.getComputedTextLength();
                if(value >= 0){
                    if((text_width + 5) > barWidth){
                        console.log("x-1-1");
                        return (barWidth + 5);
                    }else{
                        console.log("x-1-2");
                        return (barWidth - text_width - 5);
                    }
                }else{
                    if((text_width + 5) > barWidth){
                        console.log("x-2-1");
                        return width - (barWidth + 5);
                    }else{
                        console.log("x-2-2");
                        return width - (barWidth - text_width - 5);
                    }
                }
            })
            .attr("y", function(){
                return 14;
            })
            .attr("dy",".35em")
            .attr("text-anchor", function(){
                if(value >= 0){
                    return "start";
                }else{
                    return "end";
                }
            });
            // .attr("class",function(){
            //     var text_width = this.getComputedTextLength();
            //     if(value >= 0){
            //         if((text_width + barWidth + 5) > width){
            //             return "text-reg";
            //         }else{
            //             return "text-reg text-positive";
            //         }
            //     }else{
            //         if((text_width + barWidth + 5) > width){
            //             return "text-negative";
            //         }else{
            //             return "text-reg text-negative";
            //         }
            //     }
            // });
        
        svg.append("rect")
            .style("fill", function(){
                if(value >= 0){
                    return positive_color;
                }else{
                    return negative_color;
                }
            })
            .attr("x", function(){
                if(value >= 0){
                    return 0;
                }else{
                    return (width - barWidth);
                }
            })
            .attr("y", 0)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("width", barWidth)
            .attr("height", height);
    </script>
    <script type="text/javascript">

   
        var max_value = 200;
        var value = 6;
       
        var width = 300,
            height = 30;

        var positive_color = "#0054a6";
        var negative_color = "#9e0b0f";

        var svg = d3.select("#container2")
            .append("svg")
            .attr("width", width)
            .attr("height", height);
        
        var barWidth = (Math.abs(value)/ Math.abs(max_value)) * width;
                console.log("barWidth: "+ barWidth);

        var text = svg.append("text")
            .text("$2,000.00")
            .style("font-size", 10)
            .attr("x", function(){
                var text_width = this.getComputedTextLength();
                console.log("text-width: "+ text_width);
                if(value >= 0){
                    if((text_width + 5) > barWidth){
                        console.log("2x-1-1");
                        return (barWidth + 5);
                    }else{
                        console.log("2x-1-2");
                        return (barWidth - text_width - 5);
                    }
                }else{
                    if((text_width + 5) > barWidth){
                        console.log("2x-2-1");
                        return width - (barWidth + 5);
                    }else{
                        console.log("2x-2-2");
                        return width - (barWidth - text_width - 5);
                    }
                }
            })
            .attr("y", function(){
                return 14;
            })
            .attr("dy",".35em")
            .attr("text-anchor", function(){
                if(value >= 0){
                    return "start";
                }else{
                    return "end";
                }
            })
            .attr("fill", function(){
                var text_width = this.getComputedTextLength();
                if(value >=0 ){
                    if((text_width + barWidth + 5) > width){
                        console.log("2text-1-1");
                        return "#fff";
                    }else{
                        console.log("2text-1-2");
                        return positive_color;
                    }
                }else{
                    if((text_width + barWidth + 5) > width){
                        console.log("2text-2-1");
                        return "#fff";
                    }else{
                        console.log("2text-2-2");
                        return negative_color;
                    }
                }
            });
            // .attr("class",function(){
            //     var text_width = this.getComputedTextLength();
            //     if(value >= 0){
            //         if((text_width + barWidth + 5) > width){
            //             return "text-reg";
            //         }else{
            //             return "text-reg text-positive";
            //         }
            //     }else{
            //         if((text_width + barWidth + 5) > width){
            //             return "text-negative";
            //         }else{
            //             return "text-reg text-negative";
            //         }
            //     }
            // });
        
        svg.append("rect")
            .style("fill", function(){
                if(value >= 0){
                    return positive_color;
                }else{
                    return negative_color;
                }
            })
            .attr("x", function(){
                if(value >= 0){
                    return 0;
                }else{
                    return (width - barWidth);
                }
            })
            .attr("y", 0)
            .attr("rx", 5)
            .attr("ry", 5)
            .attr("width", barWidth)
            .attr("height", height);
    </script>
</body>
</html>